<!DOCTYPE html>
<html>
<head>
	<title>Drinking Buddies - The Survey</title>

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>

</head>

<style>
.modal {
	display: none;
	position: fixed;
	padding-top: 100px;
	width: 100%;
	height: auto;
	overflow: auto;
	background-color: rgb(0,0,0);
	background-color: rgba(0,0,0,0.4);
}








</style>





<body>
	<div class="container">
			<div class="page-header">
				<h1>My New Drinking Buddy. My New Drinking Best Friend <small>Survey Questionnaire</small></h1>
			</div>
			<div class="page-header">
			
				<h3>About Yourself</h3>
				<form id="formInfo" class="form-horizontal">
					<div class="form-group">
						<label for="inputName" class="col-sm-2 control-label">Name (REQUIRED)</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" id="inputName">
						</div>
					</div>
					<div class="form-group">
						<label for="inputPicURL" class="col-sm-2 control-label">Link to Photo Image (REQUIRED)</label>
						<div class="col-sm-10">
							<input type="text" class="form-control" id="inputPicURL">
						</div>
					</div>
				</form>
			</div>


		<div id="questions="></div>


	<div id="buttons">
		<button id="submit">Submit</button>
		<button id="reset">Reset</button>
	</div>
	</div>

<script>

var allQuestions = [
	"I tend to repeat myself when I have a few drinks",
	"I become the life of the room after some drinks",
	"Shots, baby",
	"I can't wait to get to Friday so that I can just rest. Ha Yeah Right. Let's go to the Bar!",
	"A one on one with a drink and good discussion is an awesome night",
	"I tend to befriend strangers when I go out",
	"Forget the bar. I'd rather go to a lounge",
	"I tend to spend money I didn't plan on spending when I meet new people because I'm buying rounds",
	"I can hold my liquor. Time for another round",
	"Life moves on, so we should not have regrets"
];

var choices = [
	"Strongly Agree",
	"Agree",
	"Neutral",
	"Disagree",
	"Strongly Disagree"
];

var currentURL = window.location.origin;

(function () {
	for(i = 0; i < allQuestions.length; i++){
		var quesHeader = $("<h3></h3>").text("Question " + (i + 1));
		var question = $("<h4></h4>").text(allQuestions[i]);
		answerChoices(i);
	}
})();

function answerChoices(questionNum){
	for(j = 0; j < 5; j++){
		var divInput = "<div class='radio'><label><input type='radio' id='answ" + (questionNum + 1) + "' name='answ" + (questionNum + 1) + "' value='" + (j + 1) + "'>" + choices[j] + "</label></div>";
		$("#questions").append(divInput);
	}
}

$("#submit").click(function(){
	var currentURL = window.location.origin;

	var newFriend = {
		name: $("#inputName").val().trim(),
		photo: $("#inputPicURL").val().trim(),
		scores: []
	};


		if(!newFriend.name){
			alert("Please enter your name");
			return;
		}

		if(!newFriend.photo){
			alert("Please enter a URL for your photo");
			return;
		}

		for(i = 0; i < allQuestions.length; i++){
			if($("#answ" + (i + 1) + ":checked").val()){
				newFriend.scores[i] = parseInt($("#answ" + (i + 1) + ":checked").val());
			}
			else if (!$("#answ" + (i + 1) + ":checked").val()){
				alert("Please answer all questions");
				return;
			}
		}
	friendQuery(newFriend);
});

function friendQuery(newFriend){

		$.ajax({url: currentURL + "/api/friends", method: "GET"})
			.done(function(friendData) {
				var compat = [];

				for(i = 0; i < friendData.length; i++) {
					var friendScore = friendData[i].scores;
					var totalDif = 0;

					console.log(friendData[i].name + ": " + friendScore);
					console.log("Your Score: " + newFriend.scores);
					var compare = [];

					for(j = 0; j < 10; j++){
						compare[j] = Math.abs(friendScore[j] - newFriend.scores[j]);
						totalDif += compare[j];
					}

					console.log(friendData[i].name + " Compatibility: " + totalDif);
					compat[i] = totalDif;

				}

				var bestMatch = compat[0];
				var bestFriend = friendData[0].name;
				var friendImage = friendData[0].photo;

				for(i = 1; i < friendData.length; i++) {
					if(compat[i] < bestMatch){
						bestMatch = compat[i];
						bestFriend = friendData[i].name;
						friendImage = friendData[i].photo;
					}
				}

				console.log("Best Drinking Listener: " + bestMatch);
				console.log("Best Drinking Friend: " + bestFriend);

				$("#matchDisplay").append("<h4>" + bestFriend + "</h4><img src=" + friendImage + "width='700'>");
				$("#friendModal").show();

	$.post(currentURL + "/api/friends",
			newFriend,
			function(){

			});
		});

	}

$(".close").click(function(){
	$("#matchDisplay").empty();
	$("#friendModal").hide();
	$("#formInfo").trigger("reset");

});
</script>
</body>
</html>